{% extends "base.html" %}
{% block content %}
<h2 class="mb-4"> Your Learning Dashboard</h2>

{% if results %}
  <div class="card shadow-sm p-4 mb-4">
    <h4 class="mb-3">Recent Quiz Performance</h4>
    <canvas id="performanceChart" height="120"></canvas>
    <p class="mt-3 text-muted">Average score: <strong>{{ avg_score }}%</strong></p>
  </div>

  <div class="card shadow-sm p-4">
    <h4 class="mb-3">Recent Quiz Results</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Quiz</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
          <tr>
            <td>{{ r.date_taken.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ r.quiz.note.title if r.quiz.note else "Untitled Note" }}</td>
            <td>{{ r.score }}/{{ r.total }} ({{ (r.score / r.total * 100) | round(1) }}%)</td>
          </tr>
          {% if r.feedback %}
            <tr class="bg-light">
              <td colspan="3">
                <small class="text-muted">ðŸ’¡ {{ r.feedback }}</small>
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">
    You havenâ€™t taken any quizzes yet. Start by generating one from your notes!
  </div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('performanceChart');
new Chart(ctx, {
  type: 'line',
  data: {
    labels: {{ labels|tojson }},
    datasets: [{
      label: 'Quiz Score (%)',
      data: {{ scores|tojson }},
      borderColor: '#0d6efd',
      backgroundColor: 'rgba(13, 110, 253, 0.2)',
      fill: true,
      tension: 0.3,
      pointRadius: 4
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        max: 100
      }
    }
  }
});
</script>
{% endblock %}
